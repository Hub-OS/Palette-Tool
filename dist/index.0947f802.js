function t(t,e,a,o){return 0==o?0:t<<24|e<<16|a<<8|o}const e=document.getElementById("image-type-dialog"),a=new class{#t;#e;#a;#o;#r;#l;#i;constructor(t){this.#i={};let e={willReadFrequently:!0};this.#t=t.colorCanvas,this.#e=this.#t.getContext("2d",e),this.#a=t.paletteCanvas,this.#o=this.#a.getContext("2d",e),this.#r=t.grayCanvas,this.#l=this.#r.getContext("2d",e),this.#n()}#n(){let e=this.#a,a=0,o=!1,r=t=>{let o=e.getBoundingClientRect(),r=256/o.width;a=Math.floor((t.clientX-o.left)*r)};e.addEventListener("mousedown",t=>{0==t.button&&(r(t),o=!0)}),document.body.addEventListener("mousemove",e=>{if(!o)return;let l=a;r(e);let i=a;if(l==i)return;let n=this.#o.getImageData(0,0,256,1),d=4*l,s=4*i,c=n.data[d],h=n.data[d+1],g=n.data[d+2],m=n.data[d+3],C=t(c,h,g,m),u=n.data[s],y=n.data[s+1],p=n.data[s+2],v=n.data[s+3],I=t(u,y,p,v);this.#i[C]==l&&(this.#i[C]=i),this.#i[I]==i&&(this.#i[I]=l),n.data[d]=u,n.data[d+1]=y,n.data[d+2]=p,n.data[d+3]=v,n.data[s]=c,n.data[s+1]=h,n.data[s+2]=g,n.data[s+3]=m,this.#o.clearRect(0,0,256,1),this.#o.putImageData(n,0,0),this.#d()}),document.body.addEventListener("mouseup",()=>{o=!1})}loadImages(t){let e=t.image;this.#t.width=e.width,this.#t.height=e.height,this.#r.width=e.width,this.#r.height=e.height,"color"==t.imageType?this.#e.drawImage(e,0,0):this.#l.drawImage(e,0,0),t.paletteImage?this.#s(t.paletteImage):this.#c(),"color"==t.imageType?this.#d():this.#h()}#s(e){this.#o.clearRect(0,0,256,1),this.#o.drawImage(e,0,0);let a=this.#o.getImageData(0,0,256,1);this.#i={};for(let e=0;e<1024;e+=4){let o=a.data[e],r=t(o,a.data[e+1],a.data[e+2],a.data[e+3]);void 0==this.#i[r]&&(this.#i[r]=e/4)}}#c(){let e=this.#t.width,a=this.#t.height,o=this.#e.getImageData(0,0,e,a);this.#i={0:0};let r=0;this.#o.clearRect(0,0,256,1);for(let l=0;l<e*a*4;l+=4){let e=o.data[l],a=o.data[l+1],i=o.data[l+2],n=o.data[l+3],d=t(e,a,i,n);0!=d&&void 0==this.#i[d]&&(r+=1,this.#i[d]=r,this.#o.fillStyle=`rgba(${e}, ${a}, ${i}, ${n/255})`,this.#o.fillRect(r,0,1,1))}}#d(){let e=this.#t.width,a=this.#t.height,o=this.#e.getImageData(0,0,e,a);for(let r=0;r<e*a*4;r+=4){let e=o.data[r],a=t(e,o.data[r+1],o.data[r+2],o.data[r+3]),l=this.#i[a];o.data[r]=l,o.data[r+1]=l,o.data[r+2]=l,o.data[r+3]=0==l?0:255}this.#l.clearRect(0,0,e,a),this.#l.putImageData(o,0,0)}#h(){let t=this.#t.width,e=this.#t.height,a=this.#l.getImageData(0,0,t,e),o=this.#o.getImageData(0,0,256,1);for(let r=0;r<t*e*4;r+=4){let t=4*a.data[r];a.data[r]=o.data[t],a.data[r+1]=o.data[t+1],a.data[r+2]=o.data[t+2],a.data[r+3]=o.data[t+3]}this.#e.clearRect(0,0,t,e),this.#e.putImageData(a,0,0)}}({paletteCanvas:document.getElementById("palette"),colorCanvas:document.getElementById("color"),grayCanvas:document.getElementById("grayscale")}),o={};function r(t){console.error(t),alert(t)}function l(){let t=o.imageError?o.imageError:o.image?"grayscale"!=o.imageType||o.paletteImage?void 0:"Missing palette file":"Missing image file";document.getElementById("error").innerText=t||"",!t&&o.imageType&&(a.loadImages(o),o.paletteImage=void 0)}async function i(t){for(let e of t)if(e.name.endsWith(".png"))try{let t=await function(t){return new Promise((e,a)=>{let o=new FileReader;o.onload=function(){let r=new Image;r.src=o.result,r.onload=function(){e(r)},r.onerror=function(){a(Error(`Failed to load "${t.name}"`))}},o.onerror=function(){a(Error(`Failed to load "${t.name}: ${o.error}"`))},o.readAsDataURL(t)})}(e);1==t.height&&256==t.width?o.paletteImage=t:(o.image=t,o.imageType=void 0),o.imageError=void 0}catch(t){console.error(t),o.imageError=t.toString()}o.image&&!o.imageType&&e.show()}function n(t){return function(){o.imageType=t,e.close(),l()}}document.body.addEventListener("dragover",t=>t.preventDefault()),document.body.addEventListener("drop",t=>{let e=t.dataTransfer?.items;if(!e)return;t.preventDefault();let a=[];for(let t of e){let e=t.getAsFile();e&&a.push(e)}i(a).catch(r).finally(()=>{l()})}),document.getElementById("set-color").onclick=n("color"),document.getElementById("set-grayscale").onclick=n("grayscale");
//# sourceMappingURL=index.0947f802.js.map
